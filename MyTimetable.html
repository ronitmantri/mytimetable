<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="VB51wZqua5wnRCYHOtVgclV6njLM3t6Jb3Ll1eSDd5c" />
<title>MyTimetable</title>
<link rel="icon" type="image/png" href="https://i.ibb.co/21BL0FJy/842529-FA-2829-464-E-88-B2-B831-CCEBB9-F9.png">
<link rel="apple-touch-icon" href="https://i.ibb.co/21BL0FJy/842529-FA-2829-464-E-88-B2-B831-CCEBB9-F9.png">
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiTXlUaW1ldGFibGUiLCJzaG9ydF9uYW1lIjoiTXlUaW1ldGFibGUiLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzY2N2VlYSIsInRoZW1lX2NvbG9yIjoiIzY2N2VlYSIsImljb25zIjpbeyJzcmMiOiJodHRwczovL2kuaWJiLmNvLzIxQkwwRkp5Lzg0MjUyOS1GQS0yODI5LTQ2NC1FLTg4LUIyLUI4MzEtQ0NFQkI5LUY5LnBuZyIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9wbmcifV19">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
color: white;
overflow-x: hidden;
}
body.dark-mode {
background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
}
.aurora-bg {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: -1;
overflow: hidden;
}
.aurora-bg::before,
.aurora-bg::after {
content: '';
position: absolute;
width: 200%;
height: 200%;
animation: aurora 20s ease-in-out infinite;
}
.aurora-bg::before {
background: radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
radial-gradient(circle at 80% 80%, rgba(138, 35, 135, 0.3) 0%, transparent 50%);
animation-delay: -10s;
}
.aurora-bg::after {
background: radial-gradient(circle at 60% 70%, rgba(41, 128, 185, 0.3) 0%, transparent 50%),
radial-gradient(circle at 40% 40%, rgba(142, 68, 173, 0.3) 0%, transparent 50%);
}
@keyframes aurora {
0%, 100% { transform: translate(0, 0) rotate(0deg); }
33% { transform: translate(-5%, -5%) rotate(120deg); }
66% { transform: translate(5%, 5%) rotate(240deg); }
}
.login-screen {
display: flex;
align-items: center;
justify-content: center;
min-height: 100vh;
padding: 20px;
}
.login-card {
background: rgba(255, 255, 255, 0.1);
backdrop-filter: blur(20px);
border-radius: 20px;
border: 1px solid rgba(255, 255, 255, 0.2);
box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
padding: 40px;
max-width: 400px;
width: 100%;
text-align: center;
animation: fadeIn 0.5s ease;
}
.login-card h1 {
font-size: 32px;
margin-bottom: 10px;
color: white;
}
.login-card p {
color: rgba(255, 255, 255, 0.7);
margin-bottom: 30px;
}
.input-field {
width: 100%;
padding: 12px;
margin-bottom: 10px;
border-radius: 8px;
border: 1px solid rgba(255, 255, 255, 0.2);
background: rgba(255, 255, 255, 0.1);
color: white;
font-size: 14px;
outline: none;
}
.input-field::placeholder {
color: rgba(255, 255, 255, 0.5);
}
.btn {
background: #00d4ff;
color: white;
border: none;
border-radius: 10px;
padding: 15px 30px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
width: 100%;
margin-bottom: 10px;
transition: transform 0.2s;
display: flex;
align-items: center;
justify-content: center;
}
.btn:hover {
transform: scale(1.05);
}
.btn:active {
transform: scale(0.98);
}
.github-btn {
background: #24292e;
position: relative;
justify-content: center;
}
.github-btn svg {
position: absolute;
left: 20px;
}
.link-text {
font-size: 12px;
color: rgba(255, 255, 255, 0.7);
margin-top: 15px;
}
.link-text a {
color: #00d4ff;
cursor: pointer;
text-decoration: none;
}
.divider {
display: flex;
align-items: center;
margin: 20px 0;
}
.divider::before,
.divider::after {
content: '';
flex: 1;
height: 1px;
background: rgba(255, 255, 255, 0.2);
}
.divider span {
padding: 0 15px;
font-size: 12px;
color: rgba(255, 255, 255, 0.7);
}
.glass-card {
background: rgba(255, 255, 255, 0.1);
backdrop-filter: blur(20px);
border-radius: 20px;
border: 1px solid rgba(255, 255, 255, 0.2);
box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
padding: 20px;
transition: transform 0.3s;
}
.glass-card:hover {
transform: translateY(-5px);
box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.5);
}
@keyframes fadeIn {
from {
opacity: 0;
transform: translateY(20px);
}
to {
opacity: 1;
transform: translateY(0);
}
}
.fade-in {
animation: fadeIn 0.5s ease;
}
@keyframes shimmer {
0%, 100% { opacity: 1; }
50% { opacity: 0.8; }
}
@keyframes pulse {
0%, 100% { transform: scale(1); box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3); }
50% { transform: scale(1.02); box-shadow: 0 6px 30px rgba(0, 255, 136, 0.5); }
}
.progress-fill {
animation: shimmer 2s infinite;
}
.nav-bar {
position: fixed;
top: 0;
left: 0;
right: 0;
height: 60px;
background: rgba(255, 255, 255, 0.05);
backdrop-filter: blur(20px);
border-bottom: 1px solid rgba(255, 255, 255, 0.2);
display: flex;
justify-content: space-between;
align-items: center;
padding: 0 20px;
z-index: 1000;
}
.nav-icon {
width: 40px;
height: 40px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
border-radius: 10px;
font-size: 24px;
color: white;
}
.nav-icon:hover {
background: rgba(255, 255, 255, 0.1);
}
.nav-right {
display: flex;
gap: 10px;
align-items: center;
}
.user-avatar {
width: 36px;
height: 36px;
border-radius: 50%;
border: 2px solid #00d4ff;
display: flex;
align-items: center;
justify-content: center;
background: #00d4ff;
font-weight: bold;
font-size: 16px;
color: white;
}
.container {
max-width: 600px;
margin: 0 auto;
padding: 80px 20px 20px;
}
.home-screen {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
min-height: calc(100vh - 100px);
overflow: hidden;
}
.lesson-card {
width: 100%;
max-width: 500px;
margin-bottom: 20px;
text-align: center;
}
.lesson-label {
font-size: 14px;
color: rgba(255, 255, 255, 0.7);
margin-bottom: 10px;
text-transform: uppercase;
letter-spacing: 2px;
}
.lesson-name {
font-size: 32px;
font-weight: 700;
margin-bottom: 5px;
color: white;
}
.lesson-time {
font-size: 18px;
color: rgba(255, 255, 255, 0.7);
}
.progress-container {
width: 100%;
max-width: 500px;
margin: 30px 0;
}
.progress-label {
display: flex;
justify-content: space-between;
margin-bottom: 10px;
font-size: 14px;
color: rgba(255, 255, 255, 0.7);
}
.progress-bar {
width: 100%;
height: 12px;
background: rgba(255, 255, 255, 0.1);
border-radius: 10px;
overflow: hidden;
}
.progress-fill {
height: 100%;
background: linear-gradient(90deg, #00d4ff, #00ff88);
border-radius: 10px;
transition: width 1s ease;
box-shadow: 0 0 20px #00d4ff;
}
.footer {
position: fixed;
bottom: 20px;
left: 50%;
transform: translateX(-50%);
}
.config-btn {
background: rgba(255, 255, 255, 0.1);
backdrop-filter: blur(20px);
border: 1px solid rgba(255, 255, 255, 0.2);
color: white;
padding: 10px 24px;
border-radius: 20px;
cursor: pointer;
font-size: 14px;
transition: all 0.3s;
}
.config-btn:hover {
background: rgba(255, 255, 255, 0.2);
transform: scale(1.05);
}
.menu-panel {
position: fixed;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
backdrop-filter: blur(30px);
z-index: 2000;
transition: left 0.3s;
overflow-y: auto;
}
.menu-panel.active {
left: 0;
}
.menu-content {
padding: 80px 20px;
max-width: 500px;
margin: 0 auto;
}
.menu-content h2 {
color: white;
margin-bottom: 30px;
font-size: 32px;
}
.menu-item {
background: rgba(255, 255, 255, 0.1);
backdrop-filter: blur(20px);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 15px;
padding: 20px;
margin-bottom: 15px;
cursor: pointer;
transition: all 0.3s;
display: flex;
align-items: center;
gap: 15px;
color: white;
}
.menu-item:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateX(10px);
}
.menu-item-icon {
font-size: 24px;
width: 40px;
text-align: center;
}
.menu-item-text {
font-size: 18px;
font-weight: 500;
}
.page {
display: none;
}
.page.active {
display: block;
}
.page-header {
font-size: 28px;
font-weight: 700;
margin-bottom: 20px;
color: white;
}
.timetable-day {
background: rgba(255, 255, 255, 0.1);
backdrop-filter: blur(20px);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 15px;
padding: 15px;
margin-bottom: 15px;
}
.day-header {
font-size: 18px;
font-weight: 600;
margin-bottom: 10px;
color: #00d4ff;
}
.lesson-item {
padding: 10px;
margin-bottom: 8px;
background: rgba(255, 255, 255, 0.05);
border-radius: 10px;
display: flex;
justify-content: space-between;
color: white;
}
.lesson-item span:last-child {
color: rgba(255, 255, 255, 0.7);
}
.hidden {
display: none;
}
.btn-danger {
background: #ff4757;
}
.setting-item {
background: rgba(255, 255, 255, 0.1);
backdrop-filter: blur(20px);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 15px;
padding: 20px;
margin-bottom: 15px;
display: flex;
justify-content: space-between;
align-items: center;
}
.setting-label {
font-size: 16px;
font-weight: 500;
color: white;
}
.toggle-switch {
width: 50px;
height: 26px;
background: rgba(255, 255, 255, 0.2);
border-radius: 13px;
position: relative;
cursor: pointer;
transition: background 0.3s;
}
.toggle-switch.active {
background: #00d4ff;
}
.toggle-slider {
width: 22px;
height: 22px;
background: white;
border-radius: 50%;
position: absolute;
top: 2px;
left: 2px;
transition: left 0.3s;
}
.toggle-switch.active .toggle-slider {
left: 26px;
}
.credit {
position: fixed;
bottom: 10px;
right: 10px;
font-size: 12px;
color: rgba(255, 255, 255, 0.7);
z-index: 100;
}
button {
transition: all 0.2s ease;
}
button:hover {
transform: scale(1.05);
filter: brightness(1.1);
}
button:active {
transform: scale(0.95);
}
.calc-btn {
padding: 22px;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 12px;
color: white;
font-size: 22px;
font-weight: 600;
cursor: pointer;
transition: all 0.2s;
}
.calc-btn:hover {
background: rgba(255, 255, 255, 0.15);
transform: scale(1.05);
}
.calc-btn:active {
transform: scale(0.95);
}
.calc-operator {
background: rgba(0, 212, 255, 0.3) !important;
border: 1px solid rgba(0, 212, 255, 0.5) !important;
font-size: 26px !important;
}
.calc-clear {
background: rgba(255, 100, 100, 0.3) !important;
border: 1px solid rgba(255, 100, 100, 0.5) !important;
}
.calc-backspace {
background: rgba(255, 150, 100, 0.3) !important;
border: 1px solid rgba(255, 150, 100, 0.5) !important;
}
.calc-equals {
background: rgba(0, 255, 136, 0.3) !important;
border: 1px solid rgba(0, 255, 136, 0.5) !important;
font-size: 26px !important;
}
.selection-card {
background: rgba(255, 255, 255, 0.1);
backdrop-filter: blur(20px);
border-radius: 20px;
border: 1px solid rgba(255, 255, 255, 0.2);
box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
padding: 30px;
margin-bottom: 15px;
cursor: pointer;
transition: all 0.3s;
text-align: center;
}
.selection-card:hover {
transform: translateY(-5px);
background: rgba(255, 255, 255, 0.15);
box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.5);
}
.selection-card h3 {
font-size: 24px;
margin-bottom: 10px;
color: white;
}
.selection-card p {
color: rgba(255, 255, 255, 0.7);
font-size: 14px;
}
</style>
</head>
<body>
<div class="aurora-bg"></div>

<div id="loginScreen" class="login-screen">
<div class="login-card">
<h1>MyTimetable</h1>
<p>Track your lessons and stay organized</p>
<div id="signInForm">
<input type="email" id="signInEmail" class="input-field" placeholder="Email address">
<input type="password" id="signInPassword" class="input-field" placeholder="Password">
<button class="btn" onclick="signIn()">Sign In</button>
<p class="link-text">Don't have an account? <a onclick="toggleAuthForm()">Sign up</a></p>
<div class="divider"><span>OR</span></div>
<button class="btn github-btn" onclick="signInWithGitHub(event)">
<svg width="20" height="20" viewBox="0 0 24 24" fill="white">
<path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
</svg>
Continue with GitHub
</button>
<button class="btn github-btn" onclick="signInWithGitLab(event)" style="background: #FC6D26;">
<svg width="20" height="20" viewBox="0 0 380 380" fill="white">
<path d="M282.83,170.73l-.27-.69-26.14-68.22a6.81,6.81,0,0,0-2.69-3.24,7,7,0,0,0-8,.43,7,7,0,0,0-2.32,3.52l-17.65,54H154.29l-17.65-54A6.86,6.86,0,0,0,134.32,99a7,7,0,0,0-8-.43,6.87,6.87,0,0,0-2.69,3.24L97.44,170l-.26.69a48.54,48.54,0,0,0,16.1,56.1l.09.07.24.17,39.82,29.82,19.7,14.91,12,9.06a8.07,8.07,0,0,0,9.76,0l12-9.06,19.7-14.91,40.06-30,.1-.08A48.56,48.56,0,0,0,282.83,170.73Z"/>
</svg>
Continue with GitLab
</button>
<div class="divider"><span>OR</span></div>
<button class="btn" onclick="continueAsGuest()" style="background: rgba(255, 255, 255, 0.1); position: relative;">
‚ú® Continue as Guest
<span style="position: absolute; top: -8px; right: -8px; background: linear-gradient(135deg, #ff0080, #ff4444); color: white; font-size: 10px; padding: 4px 8px; border-radius: 12px; font-weight: 700; box-shadow: 0 2px 10px rgba(255, 0, 128, 0.4); animation: pulse 2s infinite;">RECOMMENDED</span>
</button>
<p class="link-text" style="font-size: 11px; margin-top: 20px; line-height: 1.4;">
<span style="opacity: 0.8; color: #00ff88;">üí° Guest mode gives instant access - no sign up needed!</span><br>
<span style="opacity: 0.6; margin-top: 5px; display: block;">OAuth providers require additional setup. Guest mode is fastest.</span>
</p>
</div>
<div id="signUpForm" class="hidden">
<input type="email" id="signUpEmail" class="input-field" placeholder="Email address">
<input type="password" id="signUpPassword" class="input-field" placeholder="Password (min 6 characters)">
<input type="password" id="signUpConfirm" class="input-field" placeholder="Confirm password">
<button class="btn" onclick="signUp()">Create Account</button>
<p class="link-text">Already have an account? <a onclick="toggleAuthForm()">Sign in</a></p>
<p class="link-text" style="font-size: 11px; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
<span style="opacity: 0.7;">üí° Tip: If sign up fails, use <a onclick="toggleAuthForm()" style="color: #00ff88; font-weight: 600;">Guest mode</a> for instant access!</span>
</p>
</div>
</div>
</div>

<div id="timetableSelectionScreen" class="login-screen hidden">
<div class="login-card" style="max-width: 500px;">
<h1>Choose Your Timetable</h1>
<p>Select how you want to organize your schedule</p>
<div class="selection-card" onclick="useGEMSTimetable()">
<h3>üìö Use GEMS WIS Class 6B Timetable</h3>
<p>Pre-configured schedule for GEMS Wellington International School Class 6B</p>
</div>
<div class="selection-card" onclick="createCustomTimetable()">
<h3>‚úèÔ∏è Add Your Own Timetable</h3>
<p>Create a personalized schedule with your own lessons and times</p>
</div>
</div>
</div>

<div id="mainApp" class="hidden">
<div class="nav-bar">
<div class="nav-icon" onclick="openMenu()">‚ò∞</div>
<div class="nav-right">
<div class="user-avatar" id="userAvatar"></div>
<div class="nav-icon hidden" id="backBtn" onclick="navigateTo('home')">‚Üê</div>
<div class="nav-icon hidden" id="homeBtn" onclick="navigateTo('home')">üè†</div>
</div>
</div>
<div class="container">
<div class="page active" id="homePage">
<div class="home-screen">
<div class="lesson-card glass-card fade-in">
<div class="lesson-label">Current Lesson</div>
<div class="lesson-name" id="currentLesson">Loading...</div>
<div class="lesson-time" id="currentTime">--:-- -- - --:-- --</div>
</div>
<div class="progress-container">
<div class="progress-label">
<span>Day Progress</span>
<span id="progressPercent">0%</span>
</div>
<div class="progress-bar">
<div class="progress-fill" id="progressFill" style="width: 0%"></div>
</div>
</div>
<div class="lesson-card glass-card fade-in">
<div class="lesson-label">Next Lesson</div>
<div class="lesson-name" id="nextLesson">Loading...</div>
<div class="lesson-time" id="nextTime">--:-- -- - --:-- --</div>
</div>
</div>
<div class="footer">
<button class="config-btn" onclick="navigateTo('settings')">‚öôÔ∏è Config</button>
</div>
</div>

<div class="page" id="timetablePage">
<h1 class="page-header">üìÖ Timetable</h1>
<div id="timetableContent"></div>
</div>

<div class="page" id="customizePage">
<h1 class="page-header">‚úèÔ∏è Customize Timetable</h1>
<p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 20px;">Create your own personalized timetable</p>
<div class="setting-item">
<div class="setting-label">Select Your Timetable Type</div>
</div>
<div style="display: grid; gap: 10px; margin-bottom: 20px;">
<button class="btn" onclick="selectTimetable('6B')" style="background: rgba(0, 212, 255, 0.2); border: 2px solid #00d4ff;">
üìö GEMS WIS Class 6B Timetable
</button>
<button class="btn" onclick="showCustomTimetable()" style="background: rgba(255, 255, 255, 0.1);">
‚úèÔ∏è Create Custom Timetable
</button>
</div>
<div id="customTimetableForm" class="hidden">
<div class="setting-item" style="display: block;">
<div class="setting-label" style="margin-bottom: 15px;">Add Your Lessons</div>
<select id="daySelect" class="input-field" style="margin-bottom: 10px;">
<option value="Monday">Monday</option>
<option value="Tuesday">Tuesday</option>
<option value="Wednesday">Wednesday</option>
<option value="Thursday">Thursday</option>
<option value="Friday">Friday</option>
</select>
<input type="text" id="lessonName" class="input-field" placeholder="Lesson name (e.g. Maths)" style="margin-bottom: 15px;">

<div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid rgba(255, 255, 255, 0.1);">
<div style="color: white; font-weight: 600; margin-bottom: 15px; font-size: 14px;">‚è∞ Start Time</div>
<div style="display: flex; gap: 15px; align-items: center; margin-bottom: 10px;">
<div style="flex: 1;">
<label style="color: rgba(255, 255, 255, 0.7); font-size: 12px; display: block; margin-bottom: 5px;">Hour</label>
<input type="range" id="startHour" min="1" max="12" value="7" oninput="updateStartTimeDisplay()" style="width: 100%;">
<div id="startHourDisplay" style="color: #00d4ff; font-size: 18px; font-weight: 600; text-align: center; margin-top: 5px;">7</div>
</div>
<div style="flex: 1;">
<label style="color: rgba(255, 255, 255, 0.7); font-size: 12px; display: block; margin-bottom: 5px;">Minute</label>
<input type="range" id="startMinute" min="0" max="55" step="5" value="50" oninput="updateStartTimeDisplay()" style="width: 100%;">
<div id="startMinuteDisplay" style="color: #00d4ff; font-size: 18px; font-weight: 600; text-align: center; margin-top: 5px;">50</div>
</div>
<div style="flex: 0.8;">
<label style="color: rgba(255, 255, 255, 0.7); font-size: 12px; display: block; margin-bottom: 5px;">Period</label>
<select id="startPeriod" onchange="updateStartTimeDisplay()" style="padding: 10px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; font-size: 16px; font-weight: 600; width: 100%;">
<option value="AM">AM</option>
<option value="PM">PM</option>
</select>
</div>
</div>
<div style="color: rgba(255, 255, 255, 0.9); font-size: 16px; text-align: center; padding: 10px; background: rgba(0, 212, 255, 0.1); border-radius: 8px; border: 1px solid rgba(0, 212, 255, 0.3);">
<span id="startTimePreview">7:50 AM</span>
</div>
</div>

<div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid rgba(255, 255, 255, 0.1);">
<div style="color: white; font-weight: 600; margin-bottom: 15px; font-size: 14px;">‚è∞ End Time</div>
<div style="display: flex; gap: 15px; align-items: center; margin-bottom: 10px;">
<div style="flex: 1;">
<label style="color: rgba(255, 255, 255, 0.7); font-size: 12px; display: block; margin-bottom: 5px;">Hour</label>
<input type="range" id="endHour" min="1" max="12" value="8" oninput="updateEndTimeDisplay()" style="width: 100%;">
<div id="endHourDisplay" style="color: #00d4ff; font-size: 18px; font-weight: 600; text-align: center; margin-top: 5px;">8</div>
</div>
<div style="flex: 1;">
<label style="color: rgba(255, 255, 255, 0.7); font-size: 12px; display: block; margin-bottom: 5px;">Minute</label>
<input type="range" id="endMinute" min="0" max="55" step="5" value="50" oninput="updateEndTimeDisplay()" style="width: 100%;">
<div id="endMinuteDisplay" style="color: #00d4ff; font-size: 18px; font-weight: 600; text-align: center; margin-top: 5px;">50</div>
</div>
<div style="flex: 0.8;">
<label style="color: rgba(255, 255, 255, 0.7); font-size: 12px; display: block; margin-bottom: 5px;">Period</label>
<select id="endPeriod" onchange="updateEndTimeDisplay()" style="padding: 10px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; font-size: 16px; font-weight: 600; width: 100%;">
<option value="AM">AM</option>
<option value="PM">PM</option>
</select>
</div>
</div>
<div style="color: rgba(255, 255, 255, 0.9); font-size: 16px; text-align: center; padding: 10px; background: rgba(0, 212, 255, 0.1); border-radius: 8px; border: 1px solid rgba(0, 212, 255, 0.3);">
<span id="endTimePreview">8:50 AM</span>
</div>
</div>

<button class="btn" onclick="addCustomLesson()" style="margin-top: 10px;">
Add Lesson
</button>
</div>
<div class="setting-item" style="display: block; margin-top: 20px;">
<div class="setting-label" style="margin-bottom: 15px;">Your Custom Timetable</div>
<div id="customTimetablePreview" style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">
No lessons added yet. Start by adding your first lesson above!
</div>
</div>
<button class="btn" onclick="saveCustomTimetable()" style="background: #00d4ff; margin-top: 10px;">
Save Custom Timetable
</button>
<button class="btn" onclick="clearCustomTimetable()" style="background: #ff4757; margin-top: 10px;">
Clear All Lessons
</button>
</div>
</div>

<div class="page" id="settingsPage">
<h1 class="page-header">‚öôÔ∏è Settings</h1>

<div class="setting-item">
<div class="setting-label">Dark Mode</div>
<div class="toggle-switch" id="darkModeToggle" onclick="toggleDarkMode()">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<div class="setting-label">Motion Effects</div>
<div class="toggle-switch active" id="motionToggle" onclick="toggleMotion()">
<div class="toggle-slider"></div>
</div>
</div>

<div id="pwaInstallPrompt" style="display: none; margin-bottom: 20px;">
<div style="background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(0, 150, 255, 0.2)); padding: 20px; border-radius: 15px; border: 2px solid rgba(0, 212, 255, 0.4); text-align: center;">
<div style="font-size: 40px; margin-bottom: 10px;">üì±</div>
<h3 style="color: white; margin-bottom: 10px; font-size: 18px;">Install for Lesson Reminders</h3>
<p style="color: rgba(255, 255, 255, 0.9); font-size: 13px; line-height: 1.6; margin-bottom: 15px;">
Install MyTimetable as an app to enable notifications and lesson reminders!
</p>
<div style="text-align: left; font-size: 12px; color: rgba(255, 255, 255, 0.8); line-height: 1.5;">
<p style="margin-bottom: 8px;"><strong style="color: #00d4ff;">üì± iOS:</strong> Safari ‚Üí Share ‚Üí Add to Home Screen</p>
<p style="margin-bottom: 8px;"><strong style="color: #00d4ff;">ü§ñ Android:</strong> Chrome ‚Üí Menu (‚ãÆ) ‚Üí Install app</p>
<p><strong style="color: #00d4ff;">üíª Desktop:</strong> Click install icon in address bar</p>
</div>
</div>
</div>

<div id="notificationSettings" style="display: none;">
<div class="setting-item">
<div class="setting-label">Lesson Reminders</div>
<div class="toggle-switch" id="notificationToggle" onclick="toggleNotifications()">
<div class="toggle-slider"></div>
</div>
</div>

<div id="notificationOptions" style="display: none; margin-left: 20px; margin-bottom: 20px;">
<div class="setting-item">
<div class="setting-label">Reminder Time</div>
<select id="reminderTime" onchange="saveReminderTime()" style="padding: 8px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; font-size: 14px;">
<option value="1">1 minute before</option>
<option value="5" selected>5 minutes before</option>
<option value="10">10 minutes before</option>
<option value="15">15 minutes before</option>
</select>
</div>

<div class="setting-item">
<div class="setting-label">Sound</div>
<div class="toggle-switch active" id="soundToggle" onclick="toggleSound()">
<div class="toggle-slider"></div>
</div>
</div>

<div class="setting-item">
<div class="setting-label">Vibration</div>
<div class="toggle-switch active" id="vibrationToggle" onclick="toggleVibration()">
<div class="toggle-slider"></div>
</div>
</div>

<div class="setting-item" style="flex-direction: column; align-items: flex-start;">
<div class="setting-label" style="margin-bottom: 10px;">Notify For:</div>
<label style="display: flex; align-items: center; margin-bottom: 8px; color: rgba(255, 255, 255, 0.9); font-size: 14px; cursor: pointer;">
<input type="checkbox" id="notifyAllLessons" checked onchange="toggleNotifyAll()" style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
All Lessons
</label>
<label style="display: flex; align-items: center; margin-bottom: 8px; color: rgba(255, 255, 255, 0.9); font-size: 14px; cursor: pointer;">
<input type="checkbox" id="notifyBreaks" onchange="toggleNotifyBreaks()" style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
Breaks
</label>
<label style="display: flex; align-items: center; color: rgba(255, 255, 255, 0.9); font-size: 14px; cursor: pointer;">
<input type="checkbox" id="notifyLunch" onchange="toggleNotifyLunch()" style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
Lunch
</label>
</div>

<button class="btn" onclick="testNotification()" style="background: rgba(0, 212, 255, 0.3); border: 1px solid #00d4ff; padding: 10px 20px; font-size: 13px;">
üîî Test Notification
</button>
</div>
</div>

<button class="btn btn-danger" onclick="signOut()">Sign Out</button>
</div>

<div class="page" id="infoPage">
<h1 class="page-header">‚ÑπÔ∏è About</h1>
<div class="glass-card" style="text-align: center; padding: 40px; background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05)); border: 2px solid rgba(255, 255, 255, 0.3);">
<img src="https://i.ibb.co/21BL0FJy/842529-FA-2829-464-E-88-B2-B831-CCEBB9-F9.png" alt="MyTimetable" style="width: 100px; height: 100px; border-radius: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); border: 3px solid rgba(255, 255, 255, 0.3);">
<h2 style="color: white; margin-bottom: 10px; font-size: 32px; font-weight: 700; text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);">MyTimetable</h2>
<p style="color: rgba(255, 255, 255, 0.8); font-size: 16px; margin-bottom: 5px;">Liquid Glass OS</p>
<p style="color: #00d4ff; font-size: 18px; font-weight: 600; margin-bottom: 30px;">Created by Ronit Mantri</p>
<div style="width: 60px; height: 4px; background: linear-gradient(90deg, transparent, #00d4ff, transparent); margin: 0 auto 30px;"></div>
<p style="color: rgba(255, 255, 255, 0.7); font-size: 14px; line-height: 1.8; max-width: 400px; margin: 0 auto;">
A beautiful glass-morphism timetable app designed to help students stay organized and on track throughout their school day.
</p>
</div>

<div class="glass-card" style="text-align: left; padding: 25px; margin-top: 20px;">
<h3 style="color: white; margin-bottom: 15px; font-size: 18px; display: flex; align-items: center;">
<span style="font-size: 24px; margin-right: 10px;">üìú</span> Apache License 2.0
</h3>
<div style="color: rgba(255, 255, 255, 0.8); font-size: 13px; line-height: 1.6; max-height: 400px; overflow-y: auto;">
<p style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9);">Copyright ¬© 2025 Ronit Mantri</p>

<p style="margin-bottom: 10px;">Licensed under the Apache License, Version 2.0 (the "License").</p>

<p style="margin-bottom: 15px; padding: 10px; background: rgba(0, 212, 255, 0.1); border-left: 3px solid #00d4ff; border-radius: 5px;">
<a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" style="color: #00d4ff; text-decoration: none; font-weight: 500;">View Full License ‚Üí</a>
</p>

<p style="margin-bottom: 20px; font-size: 12px; color: rgba(255, 255, 255, 0.7);">Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</p>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
<div style="padding: 12px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1);">
<div style="font-size: 20px; margin-bottom: 5px;">‚úì</div>
<div style="font-size: 11px; color: rgba(255, 255, 255, 0.9);">Free to use & modify</div>
</div>
<div style="padding: 12px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1);">
<div style="font-size: 20px; margin-bottom: 5px;">‚úì</div>
<div style="font-size: 11px; color: rgba(255, 255, 255, 0.9);">Open source</div>
</div>
<div style="padding: 12px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1);">
<div style="font-size: 20px; margin-bottom: 5px;">‚úì</div>
<div style="font-size: 11px; color: rgba(255, 255, 255, 0.9);">Commercial use allowed</div>
</div>
<div style="padding: 12px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1);">
<div style="font-size: 20px; margin-bottom: 5px;">‚úì</div>
<div style="font-size: 11px; color: rgba(255, 255, 255, 0.9);">Attribution required</div>
</div>
</div>

<p style="margin-top: 25px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.15); text-align: center;">
<a href="https://mytimetable.neocities.org/privacypolicy" target="_blank" style="color: #00d4ff; text-decoration: none; font-weight: 500; font-size: 13px;">üîí Privacy Policy</a>
</p>
</div>
</div>
</div>

<div class="page" id="calculatorPage">
<h1 class="page-header">üî¢ Calculator</h1>
<div class="glass-card" style="max-width: 400px; margin: 0 auto; padding: 20px;">
<div id="calcDisplay" style="background: rgba(0, 0, 0, 0.3); padding: 25px 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid rgba(255, 255, 255, 0.2); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
<div id="calcExpression" style="text-align: right; font-size: 16px; color: rgba(255, 255, 255, 0.6); min-height: 24px; margin-bottom: 5px;">&nbsp;</div>
<div id="calcValue" style="text-align: right; font-size: 36px; font-weight: 600; color: white; min-height: 45px;">0</div>
</div>
<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
<button class="calc-btn calc-clear" onclick="calcClear()" style="grid-column: span 2;">AC</button>
<button class="calc-btn calc-backspace" onclick="calcBackspace()">DEL</button>
<button class="calc-btn calc-operator" onclick="calcAppend('/')">√∑</button>

<button class="calc-btn" onclick="calcAppend('7')">7</button>
<button class="calc-btn" onclick="calcAppend('8')">8</button>
<button class="calc-btn" onclick="calcAppend('9')">9</button>
<button class="calc-btn calc-operator" onclick="calcAppend('*')">√ó</button>

<button class="calc-btn" onclick="calcAppend('4')">4</button>
<button class="calc-btn" onclick="calcAppend('5')">5</button>
<button class="calc-btn" onclick="calcAppend('6')">6</button>
<button class="calc-btn calc-operator" onclick="calcAppend('-')">‚àí</button>

<button class="calc-btn" onclick="calcAppend('1')">1</button>
<button class="calc-btn" onclick="calcAppend('2')">2</button>
<button class="calc-btn" onclick="calcAppend('3')">3</button>
<button class="calc-btn calc-operator" onclick="calcAppend('+')">+</button>

<button class="calc-btn" onclick="calcAppend('0')" style="grid-column: span 2;">0</button>
<button class="calc-btn" onclick="calcAppend('.')">.</button>
<button class="calc-btn calc-equals" onclick="calcEquals()">=</button>
</div>
</div>
</div>

<div class="page" id="notesPage">
<h1 class="page-header">üìù Notes</h1>
<div style="margin-bottom: 20px;">
<button class="btn" onclick="createNewNote()" style="background: rgba(0, 212, 255, 0.3); border: 2px solid #00d4ff; width: 100%;">
‚ûï New Note
</button>
</div>
<div id="notesList"></div>
<div id="noteEditor" class="hidden">
<div class="glass-card" style="padding: 25px;">
<input type="text" id="noteTitle" placeholder="Note Title" class="input-field" style="margin-bottom: 15px; font-size: 18px; font-weight: 600;">
<textarea id="noteContent" placeholder="Start typing your notes here..." style="width: 100%; min-height: 300px; padding: 15px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; color: white; font-size: 14px; font-family: inherit; resize: vertical; line-height: 1.6;"></textarea>
<div style="display: flex; gap: 10px; margin-top: 15px;">
<button class="btn" onclick="saveNote()" style="background: rgba(0, 255, 136, 0.3); border: 1px solid rgba(0, 255, 136, 0.5); flex: 1;">
üíæ Save
</button>
<button class="btn" onclick="cancelNote()" style="background: rgba(255, 100, 100, 0.3); border: 1px solid rgba(255, 100, 100, 0.5); flex: 1;">
‚úñ Cancel
</button>
<button class="btn" id="deleteNoteBtn" onclick="deleteNote()" style="background: rgba(255, 0, 0, 0.3); border: 1px solid rgba(255, 0, 0, 0.5); display: none;">
üóëÔ∏è Delete
</button>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<div class="menu-panel" id="menuPanel" onclick="if(event.target.id==='menuPanel') closeMenu()">
<div class="menu-content">
<h2>Menu</h2>
<div class="menu-item" onclick="navigateTo('timetable')">
<div class="menu-item-icon">üìÖ</div>
<div class="menu-item-text">View Timetable</div>
</div>
<div class="menu-item" onclick="navigateTo('customize')">
<div class="menu-item-icon">‚úèÔ∏è</div>
<div class="menu-item-text">Customize Timetable</div>
</div>
<div class="menu-item" onclick="navigateTo('settings')">
<div class="menu-item-icon">‚öôÔ∏è</div>
<div class="menu-item-text">Settings</div>
</div>
<div class="menu-item" onclick="navigateTo('calculator')">
<div class="menu-item-icon">üî¢</div>
<div class="menu-item-text">Calculator</div>
</div>
<div class="menu-item" onclick="navigateTo('notes')">
<div class="menu-item-icon">üìù</div>
<div class="menu-item-text">Notes</div>
</div>
<div class="menu-item" onclick="navigateTo('info')">
<div class="menu-item-icon">‚ÑπÔ∏è</div>
<div class="menu-item-text">Info</div>
</div>
</div>
</div>

<script>
const supabase = window.supabase.createClient(
'https://vuuyxmazxnpbbkppmvyh.supabase.co',
'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ1dXl4bWF6eG5wYmJrcHBtdnloIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyNDQ5NjgsImV4cCI6MjA3NzgyMDk2OH0.dQMR1b_4Q8NbqT_FprAmzLFu5H4jm8gWfgCGI3-MAzQ',
{
auth: {
persistSession: true,
autoRefreshToken: true,
detectSessionInUrl: true,
storageKey: 'mytimetable-auth',
storage: window.localStorage
}
}
);

let currentUser = null;
let customTimetableData = {};
let isUsingCustomTimetable = false;
let pendingOTPEmail = '';
let pendingOTPType = ''; // 'signin' or 'signup'

const timetable = {
Monday: [
{ name: 'Library', time: '7:40 - 7:50 AM' },
{ name: 'Maths', time: '7:50 - 8:50 AM' },
{ name: 'Spelling', time: '8:50 - 9:10 AM' },
{ name: 'Physical Education', time: '9:10 - 10:10 AM' },
{ name: 'Break (TT)', time: '10:10 - 10:30 AM' },
{ name: 'Assembly', time: '10:30 - 11:30 AM' },
{ name: 'English', time: '11:30 AM - 12:30 PM' },
{ name: 'Guided Reading', time: '12:30 - 1:10 PM' },
{ name: 'Lunch', time: '1:10 - 1:50 PM' },
{ name: 'Arabic A/B', time: '1:50 - 2:50 PM' },
{ name: 'Library', time: '2:50 - 3:00 PM' }
],
Tuesday: [
{ name: 'Maths', time: '7:50 - 8:50 AM' },
{ name: 'SPAG', time: '8:50 - 9:10 AM' },
{ name: 'Art / Design Technology', time: '9:10 - 10:10 AM' },
{ name: 'Break (TT)', time: '10:10 - 10:30 AM' },
{ name: 'Islamic A/B', time: '10:30 - 11:30 AM' },
{ name: 'English', time: '11:30 AM - 12:30 PM' },
{ name: 'Performing Arts', time: '12:30 - 1:10 PM' },
{ name: 'Lunch', time: '1:10 - 1:50 PM' },
{ name: 'Science', time: '1:50 - 2:50 PM' }
],
Wednesday: [
{ name: 'English', time: '7:50 - 8:50 AM' },
{ name: 'Homework', time: '8:50 - 9:10 AM' },
{ name: 'Music', time: '9:10 - 10:10 AM' },
{ name: 'Break (GW)', time: '10:10 - 10:30 AM' },
{ name: 'Moral, Social and Cultural Studies', time: '10:30 - 11:30 AM' },
{ name: 'Arabic A/B', time: '11:30 AM - 12:30 PM' },
{ name: 'Islamic A/B', time: '12:30 - 1:10 PM' },
{ name: 'Lunch', time: '1:10 - 1:50 PM' },
{ name: 'Maths', time: '1:50 - 2:50 PM' }
],
Thursday: [
{ name: 'Arabic A', time: '7:50 - 8:50 AM' },
{ name: 'Spelling Test', time: '8:50 - 9:10 AM' },
{ name: 'Physical Education', time: '9:10 - 10:10 AM' },
{ name: 'Break (GW)', time: '10:10 - 10:30 AM' },
{ name: 'Guided Reading', time: '10:30 - 11:30 AM' },
{ name: 'English', time: '11:30 AM - 12:30 PM' },
{ name: 'Science', time: '12:30 - 1:10 PM' },
{ name: 'Lunch', time: '1:10 - 1:50 PM' },
{ name: 'Maths', time: '1:50 - 2:50 PM' }
],
Friday: [
{ name: 'Humanities', time: '7:40 - 8:40 AM' },
{ name: 'Mental Maths', time: '8:40 - 9:20 AM' },
{ name: 'Arabic A/B', time: '9:20 - 10:20 AM' },
{ name: 'Break', time: '10:20 - 10:40 AM' },
{ name: 'Languages', time: '10:40 - 11:40 AM' }
]
};

supabase.auth.onAuthStateChange((event, session) => {
console.log('Auth state changed:', event, session?.user?.email);
if (event === 'SIGNED_IN' && session?.user) {
console.log('‚úÖ User signed in via Supabase');
currentUser = session.user;
// Save session to local storage for faster init
localStorage.setItem('current_user', JSON.stringify({
id: session.user.id,
email: session.user.email,
user_metadata: session.user.user_metadata
}));
checkTimetableSelection();
} else if (event === 'SIGNED_OUT') {
console.log('User signed out');
currentUser = null;
localStorage.removeItem('current_user');
document.getElementById('loginScreen').classList.remove('hidden');
document.getElementById('mainApp').classList.add('hidden');
document.getElementById('timetableSelectionScreen').classList.add('hidden');
} else if (event === 'INITIAL_SESSION' && session?.user) {
console.log('‚úÖ Initial session restored');
currentUser = session.user;
localStorage.setItem('current_user', JSON.stringify({
id: session.user.id,
email: session.user.email,
user_metadata: session.user.user_metadata
}));
}
});

async function init() {
console.log('=== MyTimetable Initialization ===');
console.log('URL:', window.location.href);
console.log('localStorage keys:', Object.keys(localStorage));

// Priority 1: Check for Supabase session (cross-device sync)
try {
console.log('Checking Supabase session...');
const { data: { session }, error } = await supabase.auth.getSession();
console.log('Supabase session response:', { session: session?.user?.email, error });
if (session?.user) {
console.log('‚úÖ Found Supabase session:', session.user.email);
currentUser = session.user;
// Save to localStorage for faster subsequent loads
localStorage.setItem('current_user', JSON.stringify({
id: session.user.id,
email: session.user.email,
user_metadata: session.user.user_metadata
}));
console.log('Calling checkTimetableSelection...');
checkTimetableSelection();
return;
} else {
console.log('No Supabase session found');
}
} catch (err) {
console.error('‚ö†Ô∏è Supabase session check failed:', err);
}

// Priority 2: Check for local user session
console.log('Checking local session...');
const localUser = localStorage.getItem('current_user');
if (localUser) {
try {
const user = JSON.parse(localUser);
console.log('‚úÖ Found local session:', user.email);
currentUser = user;
checkTimetableSelection();
return;
} catch (e) {
console.error('Error parsing local user:', e);
localStorage.removeItem('current_user');
}
}

// Priority 3: Check for guest mode
console.log('Checking guest mode...');
const guestMode = localStorage.getItem('guest_mode');
const guestUser = localStorage.getItem('guest_user');
if (guestMode === 'true' && guestUser) {
try {
currentUser = JSON.parse(guestUser);
console.log('‚úÖ Found guest session');
const customTimetable = localStorage.getItem('guest_custom_timetable');
const timetableType = localStorage.getItem('guest_timetable_type');
if (customTimetable) {
customTimetableData = JSON.parse(customTimetable);
}
if (timetableType === 'custom') {
isUsingCustomTimetable = true;
}
showMainApp();
return;
} catch (e) {
console.error('Error parsing guest user:', e);
}
}

// No session found - show login screen
console.log('‚ùå No existing session - showing login');
console.log('=== End Initialization ===');
}

function checkTimetableSelection() {
const timetableSelected = localStorage.getItem('timetable_selected_' + currentUser.id);
if (timetableSelected) {
const timetableType = localStorage.getItem('timetable_type_' + currentUser.id);
if (timetableType === 'custom') {
const savedCustom = localStorage.getItem('custom_timetable_' + currentUser.id);
if (savedCustom) {
customTimetableData = JSON.parse(savedCustom);
isUsingCustomTimetable = true;
}
}
showMainApp();
} else {
showTimetableSelection();
}
}

function showTimetableSelection() {
document.getElementById('loginScreen').classList.add('hidden');
document.getElementById('timetableSelectionScreen').classList.remove('hidden');
document.getElementById('mainApp').classList.add('hidden');
}

function useGEMSTimetable() {
isUsingCustomTimetable = false;
localStorage.setItem('timetable_selected_' + currentUser.id, 'true');
localStorage.setItem('timetable_type_' + currentUser.id, '6B');
showMainApp();
}

function createCustomTimetable() {
localStorage.setItem('timetable_selected_' + currentUser.id, 'true');
localStorage.setItem('timetable_type_' + currentUser.id, 'custom');
showMainApp();
navigateTo('customize');
showCustomTimetable();
}

function toggleAuthForm() {
document.getElementById('signInForm').classList.toggle('hidden');
document.getElementById('signUpForm').classList.toggle('hidden');
document.getElementById('otpForm').classList.add('hidden');
}

async function signIn() {
console.log('Sign In button clicked');
try {
const email = document.getElementById('signInEmail').value.trim();
const password = document.getElementById('signInPassword').value;
console.log('Email:', email);
if (!email) return alert('Please enter your email address');
if (!password) return alert('Please enter your password');

console.log('Attempting sign in...');

// Show loading state
const originalText = event?.target?.textContent || 'Sign In';
if (event?.target) event.target.textContent = 'Signing in...';

// Try Supabase FIRST (enables cross-device sync)
try {
const { data, error } = await supabase.auth.signInWithPassword({
email: email,
password: password
});

if (!error && data?.user) {
console.log('‚úÖ Supabase authentication successful');
// Save to local cache
const accounts = JSON.parse(localStorage.getItem('user_accounts') || '{}');
accounts[email] = {
id: data.user.id,
email: email,
password: password,
supabaseId: data.user.id,
lastSignIn: new Date().toISOString()
};
localStorage.setItem('user_accounts', JSON.stringify(accounts));
// Reset button and let auth state change handle the rest
if (event?.target) event.target.textContent = originalText;
return;
}

// Check if it's an invalid credentials error
if (error && error.message.includes('Invalid login credentials')) {
// Maybe it's a local-only account - check local storage
console.log('Invalid credentials in Supabase, checking local...');
} else if (error) {
console.error('Supabase signin error:', error);
}
} catch (supabaseErr) {
console.log('Supabase error, will check local:', supabaseErr.message);
}

// If Supabase failed, check local accounts
console.log('Checking local accounts...');
const accounts = JSON.parse(localStorage.getItem('user_accounts') || '{}');
const localAccount = accounts[email];

if (localAccount) {
// Verify password
if (localAccount.password === password) {
console.log('‚úÖ Local account authentication successful');

// Set the current user
currentUser = {
id: localAccount.id,
email: localAccount.email,
user_metadata: { email: localAccount.email }
};
localStorage.setItem('current_user', JSON.stringify(currentUser));

// Reset button
if (event?.target) event.target.textContent = originalText;

// Check if they've selected a timetable
checkTimetableSelection();
return;
} else {
// Wrong password for local account
if (event?.target) event.target.textContent = originalText;
alert('‚ùå Incorrect password.\n\nPlease try again.');
return;
}
}

// No account found anywhere
if (event?.target) event.target.textContent = originalText;
alert('‚ùå Account not found.\n\nPlease create an account first or use "Continue as Guest".');
} catch (err) {
console.error('Sign in error:', err);
if (event?.target) event.target.textContent = originalText;
alert('Error: ' + err.message);
}
}

async function signUp() {
console.log('Sign Up button clicked');
try {
const email = document.getElementById('signUpEmail').value.trim();
const password = document.getElementById('signUpPassword').value;
const confirmPassword = document.getElementById('signUpConfirm').value;

console.log('Email:', email);
if (!email) return alert('Please enter your email address');
if (!password) return alert('Please enter a password');
if (password.length < 6) return alert('Password must be at least 6 characters');
if (password !== confirmPassword) return alert('Passwords do not match');

console.log('Creating account...');

// Show loading state
const originalText = event?.target?.textContent || 'Create Account';
if (event?.target) event.target.textContent = 'Creating account...';

// Create account in Supabase (primary source - enables cross-device sync)
try {
const { data, error } = await supabase.auth.signUp({
email: email,
password: password,
options: {
emailRedirectTo: window.location.origin + window.location.pathname,
data: {
email: email
}
}
});

// Reset button
if (event?.target) event.target.textContent = originalText;

if (error) {
console.error('Supabase signup error:', error);

// Check for duplicate email
if (error.message.includes('already registered') || error.message.includes('User already registered')) {
alert('‚ö†Ô∏è This email is already registered.\n\nPlease try signing in instead.');
toggleAuthForm();
return;
}

// Network error - create local fallback account
if (error.message.includes('Failed to fetch') || 
    error.message.includes('NetworkError') || 
    error.message.includes('Load failed') ||
    error.status === 0) {
console.log('‚ö†Ô∏è Network error - creating local account');
const accounts = JSON.parse(localStorage.getItem('user_accounts') || '{}');
if (accounts[email]) {
alert('‚ö†Ô∏è This email is already registered locally.\n\nPlease try signing in instead.');
toggleAuthForm();
return;
}
const userId = 'local_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
accounts[email] = {
id: userId,
email: email,
password: password,
createdAt: new Date().toISOString()
};
localStorage.setItem('user_accounts', JSON.stringify(accounts));
alert('‚úÖ Account created offline!\n\nYou can sign in now. Account will sync when online.');
toggleAuthForm();
return;
}

// Other errors
alert('Error creating account: ' + error.message);
return;
}

// Success! Account created in Supabase
console.log('‚úÖ Supabase account created successfully');

// Check if email confirmation is required
if (data?.user?.identities?.length === 0) {
alert('‚ö†Ô∏è This email is already registered.\n\nPlease try signing in instead.');
toggleAuthForm();
return;
}

// Save to local accounts as cache
const accounts = JSON.parse(localStorage.getItem('user_accounts') || '{}');
accounts[email] = {
id: data?.user?.id,
email: email,
password: password,
supabaseId: data?.user?.id,
createdAt: new Date().toISOString()
};
localStorage.setItem('user_accounts', JSON.stringify(accounts));

alert('‚úÖ Account created successfully!\n\nYou can now sign in with your email and password.\n\nYour data will sync across all your devices!');
toggleAuthForm();
} catch (err) {
console.error('Sign up error:', err);
if (event?.target) event.target.textContent = originalText;
alert('Error: ' + err.message);
}
} catch (err) {
console.error('Sign up error:', err);
if (event?.target) event.target.textContent = 'Create Account';
alert('Error creating account: ' + err.message);
}
}

async function sendSignUpOTP() {
const email = document.getElementById('signUpEmail').value.trim();
if (!email) return alert('Please enter your email address');
if (!email.includes('@')) return alert('Please enter a valid email address');

const { error } = await supabase.auth.signInWithOtp({
email: email,
options: {
shouldCreateUser: true
}
});

if (error) return alert('Error: ' + error.message);

pendingOTPEmail = email;
pendingOTPType = 'signup';
document.getElementById('otpEmail').textContent = email;
document.getElementById('signUpForm').classList.add('hidden');
document.getElementById('otpForm').classList.remove('hidden');
}

async function sendSignInOTP() {
const email = document.getElementById('signInEmail').value.trim();
if (!email) return alert('Please enter your email address');
if (!email.includes('@')) return alert('Please enter a valid email address');

const { error } = await supabase.auth.signInWithOtp({
email: email,
options: {
shouldCreateUser: false
}
});

if (error) return alert('Error: ' + error.message);

pendingOTPEmail = email;
pendingOTPType = 'signin';
document.getElementById('otpEmail').textContent = email;
document.getElementById('signInForm').classList.add('hidden');
document.getElementById('otpForm').classList.remove('hidden');
}

async function verifyOTP() {
const token = document.getElementById('otpCode').value.trim();
if (!token) return alert('Please enter the verification code');
if (token.length !== 6) return alert('Please enter the complete 6-digit code');

const { data, error } = await supabase.auth.verifyOtp({
email: pendingOTPEmail,
token: token,
type: 'email'
});

if (error) {
alert('Invalid or expired code. Please try again.');
return;
}

if (pendingOTPType === 'signup') {
alert('Account created successfully!');
}
// Auth state change will handle the rest
}

async function resendOTP() {
if (pendingOTPType === 'signup') {
await sendSignUpOTP();
document.getElementById('signUpEmail').value = pendingOTPEmail;
} else {
await sendSignInOTP();
document.getElementById('signInEmail').value = pendingOTPEmail;
}
alert('New code sent to ' + pendingOTPEmail);
}

function backToLogin() {
document.getElementById('otpForm').classList.add('hidden');
document.getElementById('signInForm').classList.remove('hidden');
document.getElementById('signUpForm').classList.add('hidden');
document.getElementById('otpCode').value = '';
pendingOTPEmail = '';
pendingOTPType = '';
}

async function signInWithGitHub(event) {
console.log('GitHub button clicked');
try {
// Show loading state
const githubBtn = event ? event.target.closest('button') : document.querySelector('.github-btn');
if (githubBtn) {
const originalText = githubBtn.innerHTML;
githubBtn.innerHTML = '‚è≥ Connecting to GitHub...';
githubBtn.disabled = true;

const { data, error } = await supabase.auth.signInWithOAuth({
provider: 'github',
options: {
redirectTo: window.location.origin + window.location.pathname,
scopes: 'read:user user:email'
}
});

// Restore button state
githubBtn.innerHTML = originalText;
githubBtn.disabled = false;

console.log('OAuth result:', { data, error });

if (error) {
console.error('GitHub OAuth error:', error);
if (error.message.includes('not enabled')) {
alert('‚ö†Ô∏è GitHub login is not enabled yet.\n\nPlease use:\n‚Ä¢ Email/Password login\n‚Ä¢ Email magic link (OTP)\n‚Ä¢ Continue as Guest\n\nGitHub OAuth needs to be configured in Supabase dashboard.');
} else {
alert('GitHub login error: ' + error.message + '\n\nPlease try:\n‚Ä¢ Email/Password\n‚Ä¢ Continue as Guest');
}
}
}
// If successful, the browser will redirect to GitHub OAuth page
} catch (err) {
console.error('Unexpected error:', err);
alert('An unexpected error occurred. Please try another login method.');
}
}

async function signInWithGitLab(event) {
console.log('GitLab button clicked');
try {
// Show loading state
const gitlabBtn = event ? event.target.closest('button') : document.querySelector('button[onclick*="signInWithGitLab"]');
if (gitlabBtn) {
const originalText = gitlabBtn.innerHTML;
gitlabBtn.innerHTML = '‚è≥ Connecting to GitLab...';
gitlabBtn.disabled = true;

const { data, error } = await supabase.auth.signInWithOAuth({
provider: 'gitlab',
options: {
redirectTo: window.location.origin + window.location.pathname,
scopes: 'read_user'
}
});

// Restore button state
gitlabBtn.innerHTML = originalText;
gitlabBtn.disabled = false;

console.log('OAuth result:', { data, error });

if (error) {
console.error('GitLab OAuth error:', error);
if (error.message.includes('not enabled')) {
alert('‚ö†Ô∏è GitLab login is not enabled yet.\n\nPlease use:\n‚Ä¢ Email/Password login\n‚Ä¢ Email magic link (OTP)\n‚Ä¢ Continue as Guest\n\nGitLab OAuth needs to be configured in Supabase dashboard.');
} else {
alert('GitLab login error: ' + error.message + '\n\nPlease try:\n‚Ä¢ Email/Password\n‚Ä¢ Continue as Guest');
}
}
}
} catch (err) {
console.error('Unexpected error:', err);
alert('An unexpected error occurred. Please try another login method.');
}
}

function continueAsGuest() {
currentUser = {
id: 'guest-' + Date.now(),
email: 'guest@mytimetable.app',
isGuest: true
};
localStorage.setItem('guest_mode', 'true');
localStorage.setItem('guest_user', JSON.stringify(currentUser));
showTimetableSelection();
}

function showCustomTimetable() {
document.getElementById('customTimetableForm').classList.remove('hidden');
loadCustomTimetablePreview();
}

function updateStartTimeDisplay() {
const hour = document.getElementById('startHour').value;
const minute = document.getElementById('startMinute').value;
const period = document.getElementById('startPeriod').value;
document.getElementById('startHourDisplay').textContent = hour;
document.getElementById('startMinuteDisplay').textContent = minute.padStart(2, '0');
document.getElementById('startTimePreview').textContent = `${hour}:${minute.padStart(2, '0')} ${period}`;
}

function updateEndTimeDisplay() {
const hour = document.getElementById('endHour').value;
const minute = document.getElementById('endMinute').value;
const period = document.getElementById('endPeriod').value;
document.getElementById('endHourDisplay').textContent = hour;
document.getElementById('endMinuteDisplay').textContent = minute.padStart(2, '0');
document.getElementById('endTimePreview').textContent = `${hour}:${minute.padStart(2, '0')} ${period}`;
}

function selectTimetable(type) {
if (type === '6B') {
isUsingCustomTimetable = false;
localStorage.setItem('timetable_type_' + currentUser.id, '6B');
alert('Using GEMS WIS Class 6B timetable');
updateCurrentLesson();
}
}

function addCustomLesson() {
const day = document.getElementById('daySelect').value;
const name = document.getElementById('lessonName').value.trim();
const startHour = document.getElementById('startHour').value;
const startMinute = document.getElementById('startMinute').value.padStart(2, '0');
const startPeriod = document.getElementById('startPeriod').value;
const endHour = document.getElementById('endHour').value;
const endMinute = document.getElementById('endMinute').value.padStart(2, '0');
const endPeriod = document.getElementById('endPeriod').value;

if (!name) {
alert('Please enter a lesson name');
return;
}

const startTime = `${startHour}:${startMinute} ${startPeriod}`;
const endTime = `${endHour}:${endMinute} ${endPeriod}`;

if (!customTimetableData[day]) {
customTimetableData[day] = [];
}
customTimetableData[day].push({
name: name,
time: startTime + ' - ' + endTime
});
customTimetableData[day].sort((a, b) => {
const timeA = a.time.split(' - ')[0];
const timeB = b.time.split(' - ')[0];
return timeA.localeCompare(timeB);
});
document.getElementById('lessonName').value = '';
loadCustomTimetablePreview();
alert('‚úì Lesson added!');
}

function loadCustomTimetablePreview() {
const preview = document.getElementById('customTimetablePreview');
if (Object.keys(customTimetableData).length === 0) {
preview.innerHTML = 'No lessons added yet. Start by adding your first lesson above!';
return;
}
let html = '';
Object.keys(customTimetableData).forEach(day => {
html += `<div style="margin-bottom: 15px;"><strong style="color: #00d4ff;">${day}</strong><br>`;
customTimetableData[day].forEach(lesson => {
html += `<span style="font-size: 13px;">‚Ä¢ ${lesson.name} (${lesson.time})</span><br>`;
});
html += '</div>';
});
preview.innerHTML = html;
}

function saveCustomTimetable() {
if (Object.keys(customTimetableData).length === 0) {
alert('Please add at least one lesson first');
return;
}
isUsingCustomTimetable = true;
localStorage.setItem('custom_timetable_' + currentUser.id, JSON.stringify(customTimetableData));
localStorage.setItem('timetable_type_' + currentUser.id, 'custom');
alert('Custom timetable saved! Your lessons are now active.');
updateCurrentLesson();
navigateTo('home');
}

function clearCustomTimetable() {
if (confirm('Are you sure you want to clear all lessons?')) {
customTimetableData = {};
loadCustomTimetablePreview();
localStorage.removeItem('custom_timetable_' + currentUser.id);
alert('All lessons cleared');
}
}

function getCurrentTimetable() {
if (isUsingCustomTimetable && Object.keys(customTimetableData).length > 0) {
return customTimetableData;
}
return timetable;
}

async function signOut() {
if (currentUser?.isGuest) {
localStorage.removeItem('guest_mode');
localStorage.removeItem('guest_user');
localStorage.removeItem('guest_dark_mode');
localStorage.removeItem('guest_motion_effects');
localStorage.removeItem('timetable_selected_' + currentUser.id);
localStorage.removeItem('timetable_type_' + currentUser.id);
localStorage.removeItem('custom_timetable_' + currentUser.id);
currentUser = null;
document.getElementById('loginScreen').classList.remove('hidden');
document.getElementById('mainApp').classList.add('hidden');
document.getElementById('timetableSelectionScreen').classList.add('hidden');
} else {
await supabase.auth.signOut();
}
}

function showMainApp() {
document.getElementById('loginScreen').classList.add('hidden');
document.getElementById('timetableSelectionScreen').classList.add('hidden');
document.getElementById('mainApp').classList.remove('hidden');
document.getElementById('userAvatar').textContent = (currentUser.email || 'U').charAt(0).toUpperCase();
initApp();
}

async function initApp() {
await loadUserSettings();
checkPWAInstalled();
updateCurrentLesson();
loadTimetable();
updateProgress();
setInterval(updateProgress, 60000);
setInterval(updateCurrentLesson, 60000);
checkUpcomingLesson();
setInterval(checkUpcomingLesson, 60000);
}

function checkPWAInstalled() {
const isPWA = window.matchMedia('(display-mode: standalone)').matches || 
              window.navigator.standalone || 
              document.referrer.includes('android-app://');
              
if (isPWA) {
document.getElementById('notificationSettings').style.display = 'block';
document.getElementById('pwaInstallPrompt').style.display = 'none';
loadNotificationSettings();
} else {
document.getElementById('pwaInstallPrompt').style.display = 'block';
document.getElementById('notificationSettings').style.display = 'none';
}
}

function loadNotificationSettings() {
const notifEnabled = localStorage.getItem('notifications_enabled') === 'true';
const reminderTime = localStorage.getItem('reminder_time') || '5';
const soundEnabled = localStorage.getItem('notification_sound') !== 'false';
const vibrationEnabled = localStorage.getItem('notification_vibration') !== 'false';
const notifyAll = localStorage.getItem('notify_all_lessons') !== 'false';
const notifyBreaks = localStorage.getItem('notify_breaks') === 'true';
const notifyLunch = localStorage.getItem('notify_lunch') === 'true';

if (notifEnabled) {
document.getElementById('notificationToggle').classList.add('active');
document.getElementById('notificationOptions').style.display = 'block';
}

document.getElementById('reminderTime').value = reminderTime;
document.getElementById('notifyAllLessons').checked = notifyAll;
document.getElementById('notifyBreaks').checked = notifyBreaks;
document.getElementById('notifyLunch').checked = notifyLunch;

if (soundEnabled) document.getElementById('soundToggle').classList.add('active');
if (vibrationEnabled) document.getElementById('vibrationToggle').classList.add('active');
}

async function toggleNotifications() {
const toggle = document.getElementById('notificationToggle');
toggle.classList.toggle('active');
const isEnabled = toggle.classList.contains('active');

if (isEnabled) {
if ('Notification' in window) {
const permission = await Notification.requestPermission();
if (permission === 'granted') {
localStorage.setItem('notifications_enabled', 'true');
document.getElementById('notificationOptions').style.display = 'block';
alert('‚úì Lesson reminders enabled! Configure your preferences below.');
} else {
toggle.classList.remove('active');
alert('‚ö†Ô∏è Please enable notifications in your device settings to receive lesson reminders.');
}
} else {
toggle.classList.remove('active');
alert('‚ùå Notifications are not supported on this device.');
}
} else {
localStorage.setItem('notifications_enabled', 'false');
document.getElementById('notificationOptions').style.display = 'none';
}
}

function saveReminderTime() {
const time = document.getElementById('reminderTime').value;
localStorage.setItem('reminder_time', time);
}

function toggleSound() {
document.getElementById('soundToggle').classList.toggle('active');
const enabled = document.getElementById('soundToggle').classList.contains('active');
localStorage.setItem('notification_sound', enabled);
}

function toggleVibration() {
document.getElementById('vibrationToggle').classList.toggle('active');
const enabled = document.getElementById('vibrationToggle').classList.contains('active');
localStorage.setItem('notification_vibration', enabled);
}

function toggleNotifyAll() {
const enabled = document.getElementById('notifyAllLessons').checked;
localStorage.setItem('notify_all_lessons', enabled);
}

function toggleNotifyBreaks() {
const enabled = document.getElementById('notifyBreaks').checked;
localStorage.setItem('notify_breaks', enabled);
}

function toggleNotifyLunch() {
const enabled = document.getElementById('notifyLunch').checked;
localStorage.setItem('notify_lunch', enabled);
}

function testNotification() {
if ('Notification' in window && Notification.permission === 'granted') {
const vibrationEnabled = localStorage.getItem('notification_vibration') !== 'false';

new Notification('üîî Test Notification', {
body: 'This is how your lesson reminders will look!',
icon: 'https://i.ibb.co/21BL0FJy/842529-FA-2829-464-E-88-B2-B831-CCEBB9-F9.png',
badge: 'https://i.ibb.co/21BL0FJy/842529-FA-2829-464-E-88-B2-B831-CCEBB9-F9.png',
tag: 'test-notification',
requireInteraction: false
});

if (vibrationEnabled && 'vibrate' in navigator) {
navigator.vibrate([200, 100, 200]);
}
} else {
alert('Please enable notifications first!');
}
}

function checkUpcomingLesson() {
const notifEnabled = localStorage.getItem('notifications_enabled') === 'true';
if (!notifEnabled || !('Notification' in window) || Notification.permission !== 'granted') {
return;
}

const reminderTime = parseInt(localStorage.getItem('reminder_time') || '5');
const notifyAll = localStorage.getItem('notify_all_lessons') !== 'false';
const notifyBreaks = localStorage.getItem('notify_breaks') === 'true';
const notifyLunch = localStorage.getItem('notify_lunch') === 'true';
const vibrationEnabled = localStorage.getItem('notification_vibration') !== 'false';

const now = new Date();
const day = now.toLocaleDateString('en-US', { weekday: 'long' });
const currentTimetable = getCurrentTimetable();
const lessons = currentTimetable[day] || [];

for (let lesson of lessons) {
const isBreak = lesson.name.toLowerCase().includes('break');
const isLunch = lesson.name.toLowerCase().includes('lunch');
const isRegularLesson = !isBreak && !isLunch;

if (!notifyAll && isRegularLesson) continue;
if (isBreak && !notifyBreaks) continue;
if (isLunch && !notifyLunch) continue;

const [start] = lesson.time.split(' - ').map(t => {
const timeStr = t.trim();
let isPM = timeStr.includes('PM');
let isAM = timeStr.includes('AM');
let time = timeStr.replace(/AM|PM/g, '').trim();
let [h, m] = time.split(':').map(Number);

if (isPM && h !== 12) h += 12;
if (isAM && h === 12) h = 0;

const d = new Date();
d.setHours(h, m, 0, 0);
return d;
});

const reminderBefore = new Date(start.getTime() - reminderTime * 60 * 1000);
const oneMinAfter = new Date(reminderBefore.getTime() + 60 * 1000);

if (now >= reminderBefore && now < oneMinAfter) {
const lastNotif = localStorage.getItem('last_notification_' + lesson.name + '_' + lesson.time);
const today = new Date().toDateString();
if (lastNotif !== today) {
let emoji = 'üìö';
if (isBreak) emoji = '‚òï';
if (isLunch) emoji = 'üçΩÔ∏è';

new Notification(`${emoji} Upcoming: ${lesson.name}`, {
body: `Starts in ${reminderTime} minute${reminderTime > 1 ? 's' : ''} at ${lesson.time.split(' - ')[0]}`,
icon: 'https://i.ibb.co/21BL0FJy/842529-FA-2829-464-E-88-B2-B831-CCEBB9-F9.png',
badge: 'https://i.ibb.co/21BL0FJy/842529-FA-2829-464-E-88-B2-B831-CCEBB9-F9.png',
tag: 'lesson-reminder',
requireInteraction: false
});

if (vibrationEnabled && 'vibrate' in navigator) {
navigator.vibrate([200, 100, 200]);
}

localStorage.setItem('last_notification_' + lesson.name + '_' + lesson.time, today);
}
break;
}
}
}

async function loadUserSettings() {
if (currentUser?.isGuest) {
const darkMode = localStorage.getItem('guest_dark_mode') === 'true';
const motionEffects = localStorage.getItem('guest_motion_effects') !== 'false';
if (darkMode) {
document.body.classList.add('dark-mode');
document.getElementById('darkModeToggle').classList.add('active');
}
if (!motionEffects) {
document.getElementById('motionToggle').classList.remove('active');
document.querySelector('.aurora-bg').style.display = 'none';
}
return;
}

const { data } = await supabase.from('user_settings').select('*').eq('user_id', currentUser.id).single();
if (data) {
if (data.dark_mode) {
document.body.classList.add('dark-mode');
document.getElementById('darkModeToggle').classList.add('active');
}
if (!data.motion_effects) {
document.getElementById('motionToggle').classList.remove('active');
document.querySelector('.aurora-bg').style.display = 'none';
}
} else {
await supabase.from('user_settings').insert({ user_id: currentUser.id, dark_mode: false, motion_effects: true });
}
}

async function saveUserSettings() {
const darkMode = document.getElementById('darkModeToggle').classList.contains('active');
const motionEffects = document.getElementById('motionToggle').classList.contains('active');
if (currentUser?.isGuest) {
localStorage.setItem('guest_dark_mode', darkMode);
localStorage.setItem('guest_motion_effects', motionEffects);
return;
}

await supabase.from('user_settings').upsert({
user_id: currentUser.id,
dark_mode: darkMode,
motion_effects: motionEffects,
updated_at: new Date().toISOString()
});
}

function navigateTo(page) {
document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
document.getElementById(page + 'Page').classList.add('active');
if (page === 'home') {
document.getElementById('backBtn').classList.add('hidden');
document.getElementById('homeBtn').classList.add('hidden');
} else {
document.getElementById('backBtn').classList.remove('hidden');
document.getElementById('homeBtn').classList.remove('hidden');
}
if (page === 'timetable') loadTimetable();
if (page === 'notes') loadNotes();
closeMenu();
}

function openMenu() {
document.getElementById('menuPanel').classList.add('active');
}

function closeMenu() {
document.getElementById('menuPanel').classList.remove('active');
}

async function toggleDarkMode() {
document.getElementById('darkModeToggle').classList.toggle('active');
document.body.classList.toggle('dark-mode');
await saveUserSettings();
}

async function toggleMotion() {
document.getElementById('motionToggle').classList.toggle('active');
const isActive = document.getElementById('motionToggle').classList.contains('active');
document.querySelector('.aurora-bg').style.display = isActive ? 'block' : 'none';
await saveUserSettings();
}

function updateCurrentLesson() {
const now = new Date();
const day = now.toLocaleDateString('en-US', { weekday: 'long' });
const currentTimetable = getCurrentTimetable();
const lessons = currentTimetable[day] || [];
let current = null, next = null;
for (let i = 0; i < lessons.length; i++) {
const [start, end] = lessons[i].time.split(' - ').map(t => {
const [time, period] = t.split(' ');
let [h, m] = time.split(':').map(Number);
if (period === 'PM' && h !== 12) h += 12;
if (period === 'AM' && h === 12) h = 0;
const d = new Date();
d.setHours(h, m, 0, 0);
return d;
});
if (now >= start && now < end) {
current = lessons[i];
next = lessons[i + 1] || null;
break;
} else if (now < start) {
next = lessons[i];
break;
}
}
document.getElementById('currentLesson').textContent = current ? current.name : 'No Lesson';
document.getElementById('currentTime').textContent = current ? current.time : 'Free Time';
document.getElementById('nextLesson').textContent = next ? next.name : 'No More Lessons';
document.getElementById('nextTime').textContent = next ? next.time : 'Enjoy!';
}

function updateProgress() {
const now = new Date();
const start = new Date(now);
start.setHours(7, 40, 0, 0);
const end = new Date(now);
end.setHours(14, 50, 0, 0);
let percent = 0;
if (now < start) percent = 0;
else if (now > end) percent = 100;
else percent = Math.round(((now - start) / (end - start)) * 100);
document.getElementById('progressFill').style.width = percent + '%';
document.getElementById('progressPercent').textContent = percent + '%';
}

function loadTimetable() {
const container = document.getElementById('timetableContent');
container.innerHTML = '';
const currentTimetable = getCurrentTimetable();
Object.keys(currentTimetable).forEach(day => {
const div = document.createElement('div');
div.className = 'timetable-day fade-in';
let html = `<div class="day-header">${day}</div>`;
currentTimetable[day].forEach(l => {
html += `<div class="lesson-item"><span>${l.name}</span><span>${l.time}</span></div>`;
});
div.innerHTML = html;
container.appendChild(div);
});
}

// Calculator Functions
let calcCurrentValue = '0';
let calcPreviousValue = null;
let calcOperation = null;
let calcShouldResetScreen = false;

function updateCalcDisplay() {
// Format the current value for display
let displayValue = calcCurrentValue;
if (displayValue !== '0' && !displayValue.includes('.') && displayValue.length > 9) {
// Show scientific notation for very large numbers
displayValue = parseFloat(displayValue).toExponential(5);
} else if (displayValue.includes('.') && displayValue.split('.')[1].length > 8) {
// Limit decimal places
displayValue = parseFloat(displayValue).toFixed(8).replace(/\.?0+$/, '');
}
document.getElementById('calcValue').textContent = displayValue;
if (calcPreviousValue !== null && calcOperation) {
const operatorSymbol = {'+': '+', '-': '‚àí', '*': '√ó', '/': '√∑'}[calcOperation];
document.getElementById('calcExpression').textContent = `${calcPreviousValue} ${operatorSymbol}`;
} else {
document.getElementById('calcExpression').innerHTML = '&nbsp;';
}
}

function calcAppend(value) {
if (['+', '-', '*', '/'].includes(value)) {
handleOperator(value);
} else {
if (calcShouldResetScreen) {
calcCurrentValue = value;
calcShouldResetScreen = false;
} else {
if (calcCurrentValue === '0' && value !== '.') {
calcCurrentValue = value;
} else {
if (value === '.' && calcCurrentValue.includes('.')) return;
calcCurrentValue += value;
}
}
updateCalcDisplay();
}
}

function handleOperator(nextOperator) {
const inputValue = parseFloat(calcCurrentValue);

if (calcPreviousValue === null) {
calcPreviousValue = inputValue;
} else if (calcOperation) {
const result = calculate(calcPreviousValue, inputValue, calcOperation);
calcCurrentValue = String(result);
calcPreviousValue = result;
}

calcShouldResetScreen = true;
calcOperation = nextOperator;
updateCalcDisplay();
}

function calculate(firstValue, secondValue, operator) {
let result;
switch (operator) {
case '+':
result = firstValue + secondValue;
break;
case '-':
result = firstValue - secondValue;
break;
case '*':
result = firstValue * secondValue;
break;
case '/':
result = firstValue / secondValue;
break;
default:
result = secondValue;
}
// Fix floating point precision issues
if (result.toString().includes('.')) {
result = parseFloat(result.toFixed(10));
}
// Prevent scientific notation for large/small numbers
if (Math.abs(result) < 1e-10) {
result = 0;
}
return result;
}

function calcEquals() {
if (calcOperation === null || calcShouldResetScreen) {
return;
}

const inputValue = parseFloat(calcCurrentValue);
const result = calculate(calcPreviousValue, inputValue, calcOperation);
calcCurrentValue = String(result);
calcOperation = null;
calcPreviousValue = null;
calcShouldResetScreen = true;
updateCalcDisplay();
}

function calcClear() {
calcCurrentValue = '0';
calcPreviousValue = null;
calcOperation = null;
calcShouldResetScreen = false;
updateCalcDisplay();
}

function calcBackspace() {
if (calcCurrentValue.length > 1) {
calcCurrentValue = calcCurrentValue.slice(0, -1);
} else {
calcCurrentValue = '0';
}
updateCalcDisplay();
}

// Notes Functions
let currentNotes = [];
let editingNoteId = null;

function loadNotes() {
const userId = currentUser?.id || 'guest';
const saved = localStorage.getItem('notes_' + userId);
currentNotes = saved ? JSON.parse(saved) : [];
displayNotes();
}

function displayNotes() {
const container = document.getElementById('notesList');
if (currentNotes.length === 0) {
container.innerHTML = '<div class="glass-card" style="padding: 40px; text-align: center;"><p style="color: rgba(255, 255, 255, 0.7); font-size: 16px;">üìù No notes yet<br><span style="font-size: 14px;">Create your first note to get started!</span></p></div>';
return;
}
container.innerHTML = currentNotes.map((note, index) => `
<div class="glass-card" onclick="editNote(${index})" style="padding: 20px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s;">
<h3 style="color: white; margin-bottom: 8px; font-size: 18px;">${note.title || 'Untitled Note'}</h3>
<p style="color: rgba(255, 255, 255, 0.7); font-size: 14px; line-height: 1.5; margin-bottom: 10px;">${note.content.substring(0, 100)}${note.content.length > 100 ? '...' : ''}</p>
<div style="font-size: 12px; color: rgba(255, 255, 255, 0.5);">${new Date(note.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</div>
</div>
`).join('');
}

function createNewNote() {
editingNoteId = null;
document.getElementById('noteTitle').value = '';
document.getElementById('noteContent').value = '';
document.getElementById('notesList').classList.add('hidden');
document.getElementById('noteEditor').classList.remove('hidden');
document.getElementById('deleteNoteBtn').style.display = 'none';
}

function editNote(index) {
editingNoteId = index;
const note = currentNotes[index];
document.getElementById('noteTitle').value = note.title;
document.getElementById('noteContent').value = note.content;
document.getElementById('notesList').classList.add('hidden');
document.getElementById('noteEditor').classList.remove('hidden');
document.getElementById('deleteNoteBtn').style.display = 'block';
}

function saveNote() {
const title = document.getElementById('noteTitle').value.trim();
const content = document.getElementById('noteContent').value.trim();
if (!content) {
alert('Please write something in your note!');
return;
}
const note = {
title: title || 'Untitled Note',
content: content,
date: new Date().toISOString()
};
if (editingNoteId !== null) {
currentNotes[editingNoteId] = note;
} else {
currentNotes.unshift(note);
}
const userId = currentUser?.id || 'guest';
localStorage.setItem('notes_' + userId, JSON.stringify(currentNotes));
cancelNote();
displayNotes();
}

function deleteNote() {
if (confirm('Delete this note?')) {
currentNotes.splice(editingNoteId, 1);
const userId = currentUser?.id || 'guest';
localStorage.setItem('notes_' + userId, JSON.stringify(currentNotes));
cancelNote();
displayNotes();
}
}

function cancelNote() {
document.getElementById('notesList').classList.remove('hidden');
document.getElementById('noteEditor').classList.add('hidden');
editingNoteId = null;
}

// Initialize on page load
console.log('MyTimetable initializing...');
console.log('Supabase loaded:', typeof supabase !== 'undefined');
console.log('Supabase auth:', supabase?.auth ? 'Available' : 'Not available');

init();
</script>
</body>
</html>
